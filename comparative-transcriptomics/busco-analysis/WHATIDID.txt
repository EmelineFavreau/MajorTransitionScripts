mkdir busco-analysis
cd busco-analysis

# installing busco in a conda environment
conda install -c bioconda -c conda-forge busco=5.1.2 hmmer=3.3.2
mkdir input

# copy protein sequences in input
mkdir input
cd input
ln -s ../../orthology-analysis/inputOnScratch/primary_transcripts/sixSpecies/*.faa .
# based on this https://busco.ezlab.org/

# create this directory
mkdir -p ~/Scratch/conda/envs

vim  ~/.condarc

# add these lines to condarc
channels:
  - conda-forge
  - bioconda
  - defaults

ssl_verify: true

envs_dirs:
  - ~/Scratch/conda/envs

  

# include the link to the conda script into zshrc
echo ". /shared/ucl/apps/miniconda/4.5.11/etc/profile.d/conda.sh" > ~/.zshrc

# update your current settings by sourcing zshrc
source ~/.zshrc

# create the env first
conda create -n busco1 python=3.7

# To use busco, activate the environment, via this line:
conda activate busco1

module load python/miniconda3/4.5.11

# check module listed
module list
Currently Loaded Modulefiles:
  1) gcc-libs/4.9.2                13) giflib/5.1.1
  2) cmake/3.19.1                  14) emacs/26.3
  3) flex/2.5.39                   15) tmux/2.2
  4) git/2.19.1                    16) mrxvt/0.5.4
  5) apr/1.5.2                     17) userscripts/1.4.0
  6) apr-util/1.5.4                18) rcps-core/1.0.0
  7) subversion/1.8.13             19) compilers/intel/2018/update3
  8) screen/4.2.1                  20) mpi/intel/2018/update3/intel
  9) gerun                         21) default-modules/2018
 10) nano/2.4.2                    22) tree/1.7.0
 11) nedit/5.6-aug15               23) htop/1.0.3/gnu-4.9.2
 12) dos2unix/7.3                  24) python/miniconda3/4.5.11


# inside the conda environment, install the program busco
conda install -c bioconda -c conda-forge busco=4.1.4 hmmer=3.3.2

# this fails with several messages like this
ClobberError: This transaction has incompatible packages due to a shared path.
  packages: bioconda::perl-package-stash-0.38-pl526hf484d3e_1, bioconda::perl-sub-exporter-0.987-pl526_2
  path: 'man/man3/Sub::Exporter::Util.3'


# try again in a clean environment
# create the env first
conda create -n busco2 python=3.7

# To use busco, activate the environment, via this line:
conda activate busco2

module load python/miniconda3/4.5.11


# inside the conda environment, install the program busco
conda install -c bioconda -c conda-forge busco=4.1.4 hmmer=3.3.2

# running both at the same time fails because the two are in conflict

# trying first busco 4.1.4

# installing busco in a conda environment. 
module load python/miniconda3/4.5.11
conda install -c bioconda -c conda-forge busco=4.1.4 hmmer=3.3.2
conda install -c bioconda -c conda-forge busco=4.1.4
conda install -c bioconda -c conda-forge hmmer=3.3.2

# copy protein sequences in input
mkdir input
cd input
ln -s ../../orthology-analysis/inputOnScratch/primary_transcripts/sixSpecies/*.faa .

# select lineage
busco --list-datasets

# make a directory for output
mkdir -p ~/Scratch/busco-analysis/tmp
ln -s ~/Scratch/busco-analysis/tmp tmp

mkdir tmp/Ceratina_australensis

# run one test
busco -m protein -i input/Ceratina_australensis-longest-isoforms.faa -o tmp/Ceratina_australensis -l LINEAGE
