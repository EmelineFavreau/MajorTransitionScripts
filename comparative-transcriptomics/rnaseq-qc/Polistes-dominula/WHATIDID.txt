# 2020-11-02
## Author: Emeline Favreau
## Objective: Running QC steps for Polistes dominula

## Analysis steps:
# Obtaining data
# Aim 1: Run Nextflow
# Aim 2: TBD
# Aim 3: TBD

###############################################################################
# Obtaining data from Seirian's lab

# set project structure
Genusspecies="Polistes-dominula"
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/input
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/result
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/tmp
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/input inputOnScratch
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/result resultOnScratch
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/tmp tmp

# set up myriad.config (in the directory where the experiment will run)
cp ../myriad.config .

# copy input files: RNAseq raw reads, genome fasta, gff

ssh ucfaeef@transfer02

cd projects/MajorTransitionScripts/comparative-transcriptomics/Polistes-dominula/inputOnScratch/ 

# reproductives
echo -e "F03BL\nF14GR\nF42OR\nF45OR\nF48SL\nF65ORWH\nF67YLBL\nF38BL\nF47RD\nF51RD\nF69OR\nF71BL" > queen-samples

cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F03BL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F14GR*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F42OR*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F45OR*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F48SL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F65ORWH*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F67YLBL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F38BL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F47RD*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F51RD*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F69OR*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/F71BL*.fq.gz .


# non-reproductives
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W01RDYL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W08RDOR*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W09RDOR*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W13YLSL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W28ORYL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W40GROR*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W46ORYL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W49RDYL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W54ORYL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W56YLBL*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W58BLWH*.fq.gz .
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Pdom_temp/W70RDYL*.fq.gz .

exit

# get the genome
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/001/465/965/GCF_001465965.1_Pdom_r1.2/GCF_001465965.1_Pdom_r1.2_genomic.fna.gz .

# get the gff
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/001/465/965/GCF_001465965.1_Pdom_r1.2/GCF_001465965.1_Pdom_r1.2_genomic.gff.gz .


cd ..

###############################################################################
# Aim 1: Run Nextflow on one sample

mkdir tmp/hisat-one-sample

mkdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/hisat-one-sample

cp myriad.config tmp/hisat-one-sample/.

cd tmp/hisat-one-sample

tmux new-session

module load blic-modules

module load nextflow/19.10.0.5170

nextflow run nf-core/rnaseq \
	-profile singularity \
	--reads '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/W01RDYL*{1,2}.fq.gz' \
	--fasta '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.fna.gz' \
	--gff '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.gff.gz' \
	--forwardStranded \
	--skipBiotypeQC \
	--fc_group_features gene_id \
	-r 1.4.2 \
	-c /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/tmp/hisat-one-sample/myriad.config \
	-with-tower \
	-bg \
	-resume \
	--outdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/hisat-one-sample

# extravagant_engelbart worked





#########################
# running all samples 
mkdir tmp/hisat-all-samples

mkdir -p /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/hisat-all-samples

cp myriad.config tmp/hisat-all-samples/.

cd tmp/hisat-all-samples

tmux new-session

module load blic-modules

module load nextflow/19.10.0.5170

nextflow run nf-core/rnaseq \
	-profile singularity \
	--reads '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/*{1,2}.fq.gz' \
	--fasta '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.fna.gz' \
	--gff '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.gff.gz' \
	--forwardStranded \
	--skipBiotypeQC \
	--fc_group_features gene_id \
	-r 1.4.2 \
	-c /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/tmp/hisat-all-samples/myriad.config \
	-with-tower \
	-bg \
	-resume \
	--outdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/hisat-all-samples

# drunk_celsius worked

#######
# Copy important info to back-up home

Genusspecies="Polistes-dominula"

mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/qc-before-trim/
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/qc-after-trim/
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/mapping
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/sample-batch-effects-plots
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/FPKM

# list pipeline information
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/pipeline_info/software_versions.csv ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/.

cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/pipeline_info/pipeline_report.txt ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/.




# list of fastqc before trimming. Visual check looks good.
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/fastqc/zips/* ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/qc-before-trim/.

# list of fastqc after trimming. Visual check looks ok. I am surprised that the quality is not so great.
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/trim_galore/FastQC/*zip ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/qc-after-trim/.

# Check for quality of mapping to the genome - all above 89%
grep "Uniquely mapped reads %" /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/STAR/logs/*Log.final.out > ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/uniquely-mapped-reads-percentage.txt


# Check read distributions over gene features: most reads should be assigned (ie low unassigned)
# something to check in R

cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/featureCounts/gene_count_summaries/* ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/mapping/.

# check sample and batch effect:
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/sample_correlation/*pdf ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/sample-batch-effects-plots/.

# location of raw read counts (795K)
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/featureCounts/merged_gene_counts.txt ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/.


# location of StringTie's RPKM
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/hisat-all-samples/stringtieFPKM/*gene_abund.txt ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/FPKM/.


# Double-check all info are backed-up
tree ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result

# delete scratch space (10% of 1Tb)
rm -rf /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/

#####################
# 2021-01-18 calculate number of reads for each file, and for each sample, and for the whole experiment

# create tmp again
unlink tmp
mkdir -p /home/ucfaeef/Scratch/comparative-transcriptomics/Polistes-dominula/tmp
ln -s /home/ucfaeef/Scratch/comparative-transcriptomics/Polistes-dominula/tmp tmp

# copy the zip files
cp result/qc-after-trim/*.zip tmp/.

# unzip files
cd tmp
ls > sample-file-names
for filename in `cat sample-file-names`; do
	unzip ${filename}
done


cd ~/projects/MajorTransitionScripts/comparative-transcriptomics/Polistes-dominula

# calculate number of reads for each file
ls tmp/*_fastqc.zip | cut -d "/" -f 2 | cut -d "_" -f 1,2,3,4 > file-list

# run a loop to do the job

for sample in `cat file-list`; do
	grep "Total Sequences" tmp/${sample}_fastqc/fastqc_data.txt >> tmp/number-reads-in-file
done

paste file-list tmp/number-reads-in-file > result/number-reads-in-files


# calculate number of reads for each sample
cat file-list | cut -d "_" -f 1 | uniq > samples-list

# run a loop to do the job

for sample in `cat samples-list`; do
	grep ${sample} result/number-reads-in-files | awk '{sum+=$4}END{print sum}' >> tmp/number-reads-in-sample
done
paste samples-list tmp/number-reads-in-sample > result/number-reads-in-samples




#sum the read number for the whole experiment: 593620808
awk '{sum+=$2}END{print sum}' result/number-reads-in-samples



# 2021-01-26
## Author: Emeline Favreau
## Objective: Running QC steps for Polistes dominula

## Analysis steps:
# Obtaining data
# Aim 1: Run Nextflow
# Aim 2: TBD
# Aim 3: TBD

###############################################################################
# Obtaining data from Amy's lab

# set project structure
Genusspecies="Polistes-dominula"
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/input
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/result
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/tmp
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/input inputOnScratch
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/result resultOnScratch
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/tmp tmp

# set up myriad.config (in the directory where the experiment will run)
cp ../myriad.config .

# copy input files: RNAseq raw reads, genome fasta, gff

Accessions listed in Standage et al 20216	NCBI label	Associated SRA					
SAMN03940809	Worker_from_colony_1	SRR2133892	SRR2133893				
SAMN03940810	Worker_from_colony_2	no sra available for this sample. https://www.ncbi.nlm.nih.gov/biosample/?term=SRS1016453					
SAMN03940811	Worker_from_colony_3	SRR6780155					
SAMN03940812	Worker_from_colony_4	SRR2133900	SRR2133899	SRR2133895	SRR2133896		
SAMN03940813	Worker_from_colony_5	SRR2133902	SRR2133901				
SAMN03940814	Worker_from_colony_6	SRR2133903	SRR2133904				
SAMN03940815	Queen_from_colony_1	SRR2133905	SRR2133906				
SAMN03940816	Queen_from_colony_2	SRR2133907	SRR2133909				
SAMN03940817	Queen_from_colony_3	SRR2133910	SRR2133911				
SAMN03940818	Queen_from_colony_4	SRR2133913	SRR2133914				
SAMN03940819	Queen_from_colony_5	SRR2133916	SRR2133915				
SAMN03940820	Queen_from_colony_6	SRR2133917	SRR2133918				

# download the data PRJNA291219-SraAccList.txt
~/programs/sratoolkit.2.10.8-centos_linux64/bin/prefetch --option-file PRJNA291219-SraAccList.txt

ls -lhrt /lustre/scratch/scratch/ucfaeef/ncbi/sra/

	

# convert to fastq 
~/programs/sratoolkit.2.10.8-centos_linux64/bin/fastq-dump \
	--outdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/ \
	--split-files /lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133892.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133893.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133895.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133896.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133899.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133900.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133901.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133902.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133903.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133904.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133905.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133906.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133907.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133909.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133910.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133911.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133913.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133914.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133915.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133916.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133917.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR2133918.sra \
	/lustre/scratch/scratch/ucfaeef/ncbi/sra/SRR6780155.sra


ls -lrth /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/

# compress them all 
gzip /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/*.fastq


# get the genome
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/001/465/965/GCF_001465965.1_Pdom_r1.2/GCF_001465965.1_Pdom_r1.2_genomic.fna.gz

# get the gff
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/001/465/965/GCF_001465965.1_Pdom_r1.2/GCF_001465965.1_Pdom_r1.2_genomic.gff.gz


cd ..

###############################################################################
# Aim 1: Run Nextflow on one sample

mkdir tmp/star-one-sample

mkdir -p /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/Standage/star-one-sample

cp myriad.config tmp/star-one-sample/.

cd tmp/star-one-sample

tmux new-session

module load blic-modules

module load nextflow/19.10.0.5170

nextflow run nf-core/rnaseq \
	-profile singularity \
	--reads '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/SRR2133892_{1,2}.fastq.gz' \
	--fasta '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.fna.gz' \
	--gff '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.gff.gz' \
	--forwardStranded \
	--skipBiotypeQC \
	--fc_group_features gene_id \
	-r 1.4.2 \
	-c /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/tmp/star-one-sample/myriad.config \
	-with-tower \
	-bg \
	-resume \
	--outdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/Standage/star-one-sample

# jolly_mandelbrot successful





#########################
# running all samples 
mkdir tmp/star-all-samples

mkdir -p /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/Standage/star-all-samples

cp myriad.config tmp/star-all-samples/.

cd tmp/star-all-samples

tmux new-session

module load blic-modules

module load nextflow/19.10.0.5170

nextflow run nf-core/rnaseq \
	-profile singularity \
	--reads '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/*_{1,2}.fastq.gz' \
	--fasta '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.fna.gz' \
	--gff '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/input/GCF_001465965.1_Pdom_r1.2_genomic.gff.gz' \
	--forwardStranded \
	--skipBiotypeQC \
	--fc_group_features gene_id \
	-r 1.4.2 \
	-c /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/tmp/star-all-samples/myriad.config \
	-with-tower \
	-bg \
	-resume \
	--outdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/result/Standage/star-all-samples

# nasty_cajal successful

#######
# Copy important info to back-up home

Genusspecies="Polistes-dominula"

mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/qc-before-trim/
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/qc-after-trim/
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/mapping
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/sample-batch-effects-plots
mkdir -p ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/FPKM

# list pipeline information
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/pipeline_info/software_versions.csv ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/.

cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/pipeline_info/pipeline_report.txt ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/.




# list of fastqc before trimming. Visual check looks good.
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/fastqc/zips/* ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/qc-before-trim/.

# list of fastqc after trimming. Visual check looks ok. I am surprised that the quality is not so great.
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/trim_galore/FastQC/*zip ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/qc-after-trim/.

# Check for quality of mapping to the genome - all above 89%
grep "Uniquely mapped reads %" /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/STAR/logs/*Log.final.out > ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/uniquely-mapped-reads-percentage.txt


# Check read distributions over gene features: most reads should be assigned (ie low unassigned)
# something to check in R

cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/featureCounts/gene_count_summaries/* ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/mapping/.

# check sample and batch effect: not available here
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/sample_correlation/*pdf ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/sample-batch-effects-plots/.

# location of raw read counts (795K)
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/featureCounts/merged_gene_counts.txt ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/.


# location of StringTie's RPKM
cp /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/${Genusspecies}/result/Standage/star-all-samples/stringtieFPKM/*gene_abund.txt ~/projects/MajorTransitionScripts/comparative-transcriptomics/${Genusspecies}/result/Standage/FPKM/.


# Double-check all info are backed-up
tree ~/projects/MajorTransitionScripts/comparative-transcriptomics/Polistes-dominula/result/Standage

# copy NCBI info on RDS name  /mnt/gpfs/live/rd01__/ritd-ag-project-rd011y-eefav92/
ssh ucfaeef@transfer02

cd projects/MajorTransitionScripts/comparative-transcriptomics/Polistes-dominula/inputOnScratch

cd /mnt/gpfs/live/rd01__/ritd-ag-project-rd011y-eefav92/

mkdir Polistes-dominula-Standage
mkdir Polistes-dominula-Standage/genome
mkdir Polistes-dominula-Standage/gff
mkdir Polistes-dominula-Standage/rnaseq

cp /lustre/home/ucfaeef/projects/MajorTransitionScripts/comparative-transcriptomics/Polistes-dominula/inputOnScratch/*fastq.gz /mnt/gpfs/live/rd01__/ritd-ag-project-rd011y-eefav92/Polistes_dominula-Standage/rnaseq/.

cp /lustre/home/ucfaeef/projects/MajorTransitionScripts/comparative-transcriptomics/Polistes-dominula/inputOnScratch/*fna.gz /mnt/gpfs/live/rd01__/ritd-ag-project-rd011y-eefav92/Polistes_dominula-Standage/genome/.

cp /lustre/home/ucfaeef/projects/MajorTransitionScripts/comparative-transcriptomics/Polistes-dominula/inputOnScratch/*gff.gz /mnt/gpfs/live/rd01__/ritd-ag-project-rd011y-eefav92/Polistes_dominula-Standage/gff/.

exit

# delete scratch space (10% of 1Tb)
rm -rf /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Polistes-dominula/

#####################
# 2021-02-06 calculate number of reads for each file, and for each sample, and for the whole experiment
# before and after read cleaning

# create tmp
unlink tmp
mkdir -p /home/ucfaeef/Scratch/comparative-transcriptomics/Polistes-dominula/tmp
ln -s /home/ucfaeef/Scratch/comparative-transcriptomics/Polistes-dominula/tmp tmp


# Sumner lab dataset (Ben's)
# obtain sequences numbers from fastqc reports before trimming
chmod +x count-sequences-before-qc-Taylor.sh
./count-sequences-before-qc-Taylor.sh

# obtain sequences numbers from fastqc reports after trimming
chmod +x count-sequences-after-qc-Taylor.sh
./count-sequences-after-qc-Taylor.sh

# obtain final read counts from FeatureCount (this is input to DESeq2)
chmod +x count-merged-read-counts-Taylor.sh
./count-merged-read-counts-Taylor.sh

cat result/Taylor/qc-after-trim/number-reads-in-samples  
cat result/Taylor/qc-before-trim/number-reads-in-samples
cat result/Taylor/number-merged-read-counts-in-samples


