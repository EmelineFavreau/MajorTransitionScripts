# 2020-10-23
## Author: Emeline Favreau
## Objective: Running QC steps for Liostenogaster flavolineata

## Analysis steps:
# Obtaining data
# Aim 1: Run Nextflow
# Aim 2: TBD
# Aim 3: TBD

###############################################################################
# Obtaining data

# set project structure
Genusspecies="Liostenogaster-flavolineata"
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/input
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/result
mkdir -p ~/Scratch/comparative-transcriptomics/${Genusspecies}/tmp
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/input inputOnScratch
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/result resultOnScratch
ln -s ~/Scratch/comparative-transcriptomics/${Genusspecies}/tmp tmp

# set up myriad.config (in the directory where the experiment will run)
cp ../myriad.config .

# copy input files: RNAseq raw reads, genome fasta, gff

ssh ucfaeef@transfer02

cd projects/MajorTransitionScripts/comparative-transcriptomics/Liostenogaster-flavolineata/inputOnScratch/ 

# social reproductives
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Liostenogaster_flavolineata/experiment1/data/SocialReproductive*/raw/*.fq.gz .

# social foragers
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Liostenogaster_flavolineata/experiment1/data/SocialForager*/raw/*.fq.gz .

# get the genome. ben used Liostenogaster_flavolineata.fnn tho!
# I think the difference between fnn and fna is the structure (fnn sequences are wrapped to 80 characters a line, whereas fna is not). That is probably why they have slightly different file size (ls -lrth), but the same amount of sequences (grep ">" Liostenogaster_flavolineata.fn* | wc -l)
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Liostenogaster_flavolineata/genome/Liostenogaster_flavolineata.fna .

gzip -c Liostenogaster_flavolineata.fna > Liostenogaster_flavolineata.fna.gz

# get the gff
cp /mnt/gpfs/live/ritd-ag-project-rd00qm-mbent70/Liostenogaster_flavolineata/genome/Liostenogaster_flavolineata.gff3 .

gzip -c Liostenogaster_flavolineata.gff3 > Liostenogaster_flavolineata.gff.gz

exit


cd ..

###############################################################################
# Aim 1: Run Nextflow on one sample

mkdir tmp/hisat-one-sample
mkdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/result/hisat-one-sample

cp myriad.config tmp/hisat-one-sample/.

cd tmp/hisat-one-sample

tmux new-session

Genusspecies="Liostenogaster-flavolineata"

module load blic-modules

module load nextflow/19.10.0.5170

nextflow run nf-core/rnaseq \
	-profile singularity \
	--reads '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/input/SocF10_*{1,2}.fq.gz' \
	--fasta '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/input/Liostenogaster_flavolineata.fna.gz' \
	--gff '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/input/Liostenogaster_flavolineata.gff.gz' \
	--forwardStranded \
	--skipBiotypeQC \
	--fc_group_features gene_id \
	-r 1.4.2 \
	-c /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/tmp/hisat-one-sample/myriad.config \
	-with-tower \
	-bg \
	-resume \
	--outdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/result/hisat-one-sample

# mighty_mclean worked





#########################
# running all samples 
mkdir tmp/hisat-all-samples

mkdir -p /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/result/hisat-all-samples

cp myriad.config tmp/hisat-all-samples/.

cd tmp/hisat-all-samples

tmux new-session

module load blic-modules

module load nextflow/19.10.0.5170

nextflow run nf-core/rnaseq \
	-profile singularity \
	--reads '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/input/*{1,2}.fq.gz' \
	--fasta '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/input/Liostenogaster_flavolineata.fna.gz' \
	--gff '/lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/input/Liostenogaster_flavolineata.gff.gz' \
	--forwardStranded \
	--skipBiotypeQC \
	--fc_group_features gene_id \
	-r 1.4.2 \
	-c /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/tmp/hisat-all-samples/myriad.config \
	-with-tower \
	-bg \
	-resume \
	--outdir /lustre/scratch/scratch/ucfaeef/comparative-transcriptomics/Liostenogaster-flavolineata/result/hisat-all-samples

# nauseous_colden
